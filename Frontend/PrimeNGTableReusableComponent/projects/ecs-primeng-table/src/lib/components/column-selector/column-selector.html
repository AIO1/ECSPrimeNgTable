<!--COLUMN MODAL DIALOG-->
<p-dialog [(visible)]="visible" [modal]="true" [draggable]="false" [resizable]="false" [closeOnEscape]="false" [closable]="false" [maximizable]="false" [style]="{'min-width': '65vw', 'max-width': '65vw'}">
    <ng-template pTemplate="header">
        <span class="white-space-nowrap"><b>MODIFY COLUMNS</b></span>
    </ng-template>
    <div style="padding: 20px;">
        <p-table #dt_columnDialog [value]="columnModalData" [scrollable]="true" size="small" showGridlines stripedRows 
            [globalFilterFields]="['header']" scrollHeight="400px" [tableStyle]="{'min-width': '25rem'}" (onFilter)="onColumnModalFilter($event)">
            <ng-template #caption>
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <div style="display: flex; align-items: center; gap: 10px">
                        <p-checkbox inputId="selectAll" [binary]="true" [ngModel]="allColumnsCheckboxActive()" (onChange)="allColumnsCheckboxClick($event)"></p-checkbox>
                        <label for="selectAll">Select all columns</label>
                    </div>
                    <div style="display: flex; align-items: center;">
                        <p-iconField iconPosition="left" [ngClass]="{'p-input-icon-right': globalSearchText}">
                            <p-inputIcon>
                                <i class="pi pi-search"></i>
                            </p-inputIcon>
                            <input pInputText type="text" 
                                (input)="filterColumnModal($event)" autocomplete="off" 
                                [maxlength]="globalSearchMaxLength" placeholder="Search column name" [(ngModel)]="globalSearchText"
                                style="width: 220px;"/>
                            <!-- Right icon (only if there is text) -->
                            @if (globalSearchText) {
                                <p-inputIcon position="right">
                                    <i class="pi pi-times" style="cursor: pointer;" (click)="clearGlobalFilter(dt_columnDialog); $event.stopPropagation()"></i>
                                </p-inputIcon>
                            }
                        </p-iconField>
                    </div>
                </div>
            </ng-template>
            <ng-template #header>
                <tr>
                    <th pFrozenColumn style="max-width: 100px; min-width: 100px; width: 100px; text-align: center;">Show column</th>
                    <th pFrozenColumn style="max-width: 250px; min-width: 250px; width: 250px; text-align: center;">Column name</th>
                    <th style="max-width: 150px; min-width: 150px; width: 150px; text-align: center;">Cell overflow behaviour</th>
                    <th style="max-width: 160px; min-width: 160px; width: 160px; text-align: center;">Horizontal aligment</th>
                    <th style="max-width: 150px; min-width: 150px; width: 150px; text-align: center;">Vertical aligment</th>
                </tr>
            </ng-template>
            <ng-template #body let-rowData>
                <tr>
                    <td pFrozenColumn style="max-width: 100px; min-width: 100px; width: 100px; text-align: center;">
                        <p-checkbox 
                            [(ngModel)]="rowData.selected" 
                            [binary]="true"
                            [disabled]="rowData.selectDisabled"/>
                    </td>
                    <td pFrozenColumn style="max-width: 250px; min-width: 250px; width: 250px;">{{rowData.header}}</td>
                    <td style="max-width: 150px; min-width: 150px; width: 150px; text-align: center;">
                        <p-selectButton [(ngModel)]="rowData.cellOverflowBehaviour" [options]="cellOverflowBehaviourOptions" optionValue="val" optionLabel="icon" [disabled]="rowData.cellOverflowBehaviourDisabled" allowEmpty="false">
                            <ng-template #item let-item>
                                <i [class]="item.icon" style="margin: -20px;"></i>
                            </ng-template>
                        </p-selectButton>
                    </td>
                    <td style="max-width: 160px; min-width: 160px; width: 160px; text-align: center;">
                        <p-selectButton [(ngModel)]="rowData.dataAlignHorizontal" [options]="dataAlignHorizontalOptions" optionValue="val" optionLabel="icon" [disabled]="rowData.dataAlignHorizontalDisabled" allowEmpty="false">
                            <ng-template #item let-item>
                                <i [class]="item.icon" style="margin: -20px;"></i>
                            </ng-template>
                        </p-selectButton>
                    </td>
                    <td style="max-width: 150px; min-width: 150px; width: 150px; text-align: center;">
                        <p-selectButton [(ngModel)]="rowData.dataAlignVertical" [options]="dataAlignVerticalOptions" optionValue="val" optionLabel="icon" [disabled]="rowData.dataAlignVerticalDisabled" allowEmpty="false">
                            <ng-template #item let-item>
                                <i [class]="item.icon" style="margin: -20px;"></i>
                            </ng-template>
                        </p-selectButton>
                    </td>
                </tr>
            </ng-template>
            <ng-template #emptymessage>
                <tr>
                    <td colspan="999">There are no columns</td>
                </tr>
            </ng-template>
        </p-table>
        <div style="display: flex; flex-direction: row; justify-content: space-between; align-items: center; margin-top: 10px;">
            Showing {{filteredColumnData ? filteredColumnData.length : 0}} columns of {{columnModalData ? columnModalData.length : 0}} available columns
        </div>
    </div>
    <ng-template pTemplate="footer" style="display: flex; justify-content: space-between; align-items: center;">
        <p-button (click)="closeModal()" label="Cancel changes" severity="danger" [style]="{'margin-top': '10px'}"></p-button>
        <p-button (click)="applyColumnModalChanges()" label="Save changes" severity="success" [style]="{'margin-top': '10px'}"></p-button>
    </ng-template>
</p-dialog>